<link rel="import" href="/components/polymer/polymer.html" />
<link rel="import" href="/components/pages/bs-page.html" />
<link rel="import" href="/components/bs-dataset/bs-dataset-rides.html" />
<link rel="import" href="/components/iron-icon/iron-icon.html" />
<link rel="import" href="/components/iron-icons/iron-icons.html" />
<link rel="import" href="/components/iron-icons/hardware-icons.html" />
<link rel="import" href="/components/paper-item/paper-icon-item.html" />
<link rel="import" href="/components/paper-item/paper-item-body.html" />

<dom-module id="pg-ride">
    <link rel="import" href="/themes/dark-side.css" type="css" />
    <link rel="import" href="/themes/extra.css" type="css" />
    <template>
        <bs-dataset-rides query={{query}} model={{model}}></bs-dataset-rides>
        <bs-page>
            <template is="dom-repeat" items={{model}}>
                <section class="is-padded">
                    <h2>{{item.rideId}}</h2>
                </section>
                <paper-icon-item>
                    <iron-icon icon="icons:event" item-icon></iron-icon>
                    <paper-item-body>{{_getFormattedDate(item.startedAt)}}</paper-item-body>
                </paper-icon-item>
                <paper-icon-item>
                    <iron-icon icon="hardware:watch" item-icon></iron-icon>
                    <paper-item-body>
                        <div>
                            <span>{{_getFormattedTime(item.startedAt)}}</span> to
                            <span>{{_getFormattedTime(item.endedAt)}}</span>
                        </div>
                    </paper-item-body>
                </paper-icon-item>
                <paper-icon-item>
                    <iron-icon icon="icons:hourglass-empty" item-icon></iron-icon>
                    <paper-item-body>Ride analysis pending...</paper-item-body>
                </paper-icon-item>
            </template>
        </bs-page>
    </template>
    <script>
    Polymer({
        is: 'pg-ride',

        attached: function() {
            this.query = {rideId: +this.params.rideId}
        },

        _getFormattedDate: function(milliseconds) {
            console.log(this.model);
            return (new Date(milliseconds)).toDateString();
        },

        _getFormattedTime: function(milliseconds) {
            var date = new Date(milliseconds),
                hrs = date.getHours(),
                mins = date.getMinutes();

            if(mins < 10) mins = '0'+mins;

            return hrs + ':' + mins;
        }
    });
    </script>
</dom-module>
